<%- include('partials/header', { title: 'Directory | Encore', activePage: 'directory' }) %>

    <!-- Page listing performers with a search box and cards -->
    <main class="container py-4">
      <!-- Directory header + description -->
      <div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
        <div>
          <h2 class="fw-bold text-success mb-1">Performer directory</h2>
          <p class="text-muted mb-0">Search by name, act type, or city to find the right performer.</p>
        </div>
      </div>

      <!-- Directory search form -->
      <form class="input-group mb-4" method="GET" action="/directory">
        <input
          type="text"
          class="form-control"
          name="search"
          placeholder="Search by name, act type (magician, DJ, etc.), or location"
          value="<%= search || '' %>"
        />
        <button class="btn btn-success" type="submit">Search</button>
      </form>

      <!-- Performer cards grid -->
      <div class="row g-4">
        <% if (performers.length === 0) { %>
        <div class="col-12">
          <div class="alert alert-info mb-0">
            No performers match that search yet. Try a different term.
          </div>
        </div>
        <% } %>

        <% performers.forEach((p) => { %>
        <div class="col-md-6 col-lg-4">
          <a href="/performer/<%= p.userid %>" class="text-decoration-none text-reset">
          <div class="card card-elevated p-4 h-100">
            <div class="d-flex align-items-start justify-content-between mb-2">
              <div class="d-flex align-items-center gap-3">
                <% if (p.imageUrl) { %>
                <img src="<%= p.imageUrl %>" alt="Profile" class="avatar-sm" />
                <% } else { %>
                <div class="avatar-sm d-flex align-items-center justify-content-center fw-bold text-success">
                  No photo
                </div>
                <% } %>
                <div>
                  <div class="d-flex align-items-center gap-2">
                    <h5 class="fw-bold mb-1 mb-0"><%= p.name %></h5>
                    <% if (typeof currentUser !== 'undefined' && currentUser && currentUser.is_manager && p.is_manager) { %>
                    <span class="badge bg-secondary">Manager</span>
                    <% } %>
                  </div>
                  <small class="text-muted"><%= p.email %></small>
                </div>
              </div>
              <span
                class="badge <%= p.availability === 'Y' ? 'badge-available' : 'badge-unavailable' %>"
              >
                <%= p.availability === 'Y' ? 'Available' : 'Unavailable' %>
              </span>
            </div>
            <p class="text-muted mb-2">
              <span class="fw-semibold">Act type:</span> <%= p.act_category || 'N/A' %>
            </p>
            <% if (p.genre) { %>
            <p class="text-muted mb-2">
              <span class="fw-semibold">Details:</span> <%= p.genre %>
            </p>
            <% } %>
            <p class="text-muted mb-2">
              <span class="fw-semibold">Location:</span> <%= p.location || 'N/A' %>
            </p>
            <p class="text-muted mb-3"><%= p.bio ? p.bio.substring(0, 140) : 'No bio provided.' %></p>
            <a class="btn btn-outline-success btn-sm" href="mailto:<%= p.email %>" onclick="event.stopPropagation();">
              Email performer
            </a>
          </div>
          </a>
        </div>
        <% }); %>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
