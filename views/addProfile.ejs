<%- include('partials/header', { title: 'Create Profile | Encore', activePage: 'profile' }) %>

    <!-- Page for creating a new performer profile with details and avatar -->
    <main class="container py-4">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <!-- Card containing the main create-profile form -->
          <div class="card card-elevated p-4">
            <h3 class="fw-bold text-success mb-3">Create your performer profile</h3>
            <p class="text-muted">Tell organizers who you are and how to book you.</p>

            <% if (error_message && error_message !== "") { %>
            <div class="alert alert-danger py-2"><%= error_message %></div>
            <% } %>

            <!-- Form to collect performer details, availability, and profile image -->
            <form
              action="/profile/add"
              method="POST"
              enctype="multipart/form-data"
              class="mt-3"
            >
              <div class="row g-3">
                <div class="col-12">
                  <label class="form-label d-block">Show me in the performer directory?</label>
                  <div class="form-check form-check-inline">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="is_performer"
                      id="rolePerformerYes"
                      value="Y"
                      checked
                    />
                    <label class="form-check-label" for="rolePerformerYes">
                      Yes, I am a performer
                    </label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="is_performer"
                      id="rolePerformerNo"
                      value="N"
                    />
                    <label class="form-check-label" for="rolePerformerNo">
                      No, Iâ€™m just here to find talent
                    </label>
                  </div>
                </div>

                <div id="performerFields" class="row g-3 mt-1">
                  <div class="col-md-6">
                  <label class="form-label" for="act_category">Act type / category</label>
                  <select
                    class="form-select"
                    id="act_category"
                    name="act_category"
                  >
                    <option value="">Select an act type</option>
                    <option value="music">Music</option>
                    <option value="dj">DJ</option>
                    <option value="comedy">Comedy</option>
                    <option value="magic">Magic</option>
                    <option value="variety">Variety / Circus</option>
                    <option value="other">Other</option>
                  </select>
                  </div>
                  <div class="col-md-6">
                  <label class="form-label" for="location">Location</label>
                  <input
                    class="form-control"
                    type="text"
                    id="location"
                    name="location"
                    placeholder="City, State"
                  />
                  </div>
                  <div class="col-12">
                  <label class="form-label" for="genre">Details / style (optional)</label>
                  <input
                    class="form-control"
                    type="text"
                    id="genre"
                    name="genre"
                    placeholder="e.g. Jazz trio, kid-friendly magician, roast comic"
                  />
                  </div>
                  <div class="col-12">
                  <label class="form-label" for="bio">Bio</label>
                  <textarea
                    class="form-control"
                    id="bio"
                    name="bio"
                    rows="4"
                    placeholder="Share your story, highlights, and what makes you unique."
                  ></textarea>
                  </div>
                  <div class="col-12">
                    <label class="form-label d-block">Currently available?</label>
                    <div class="form-check form-check-inline">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="availability"
                        id="availableYes"
                        value="Y"
                        checked
                      />
                      <label class="form-check-label" for="availableYes">Yes</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="availability"
                        id="availableNo"
                        value="N"
                      />
                      <label class="form-check-label" for="availableNo">No</label>
                    </div>
                  </div>
                </div>

                <div class="col-12 mt-3">
                  <label class="form-label" for="profileImage">Profile image</label>
                  <input
                    class="form-control"
                    type="file"
                    id="profileImage"
                    name="profileImage"
                    accept="image/*"
                  />
                  <div class="form-text">Max 5MB. JPG, PNG, or GIF.</div>
                  <button
                    type="button"
                    class="btn btn-outline-secondary btn-sm mt-3"
                    id="toggleAvatarGalleryAdd"
                  >
                    Choose from default avatars
                  </button>
                  <div class="mt-3" id="avatarGalleryAdd" style="display: none;">
                    <label class="form-label d-block">Default avatars</label>
                    <div class="row g-2">
                      <% const defaultFiles = [
                        "Untitled design (48).png",
                        "Untitled design (49).png",
                        "Untitled design (50).png",
                        "Untitled design (51).png",
                        "Untitled design (52).png",
                        "Untitled design (53).png",
                        "Untitled design (54).png",
                        "Untitled design (55).png",
                        "Untitled design (56).png",
                        "Untitled design (57).png",
                        "Untitled design (58).png",
                      ]; %>
                      <% defaultFiles.forEach(function(file, idx) { %>
                      <div class="col-4 col-md-3">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="default_avatar"
                            id="defaultAvatarAdd<%= idx %>"
                            value="<%= file %>"
                          />
                          <label class="form-check-label d-block" for="defaultAvatarAdd<%= idx %>">
                            <img
                              src="/uploads/default-avatars/<%= file %>"
                              alt="Avatar option"
                              class="img-fluid rounded"
                            />
                          </label>
                        </div>
                      </div>
                      <% }); %>
                    </div>
                  </div>
                </div>
              </div>
              <div class="d-flex gap-2 mt-4">
                <button class="btn btn-success" type="submit">Save profile</button>
                <a class="btn btn-outline-secondary" href="/dashboard">Cancel</a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </main>

    <script>
      (function () {
        const yes = document.getElementById("rolePerformerYes");
        const no = document.getElementById("rolePerformerNo");
        const performerFields = document.getElementById("performerFields");
        const toggleGalleryBtn = document.getElementById("toggleAvatarGalleryAdd");
        const avatarGallery = document.getElementById("avatarGalleryAdd");

        function updatePerformerVisibility() {
          if (!performerFields) return;
          const show = yes && yes.checked;
          performerFields.style.display = show ? "flex" : "none";
        }

        if (yes) yes.addEventListener("change", updatePerformerVisibility);
        if (no) no.addEventListener("change", updatePerformerVisibility);
        updatePerformerVisibility();

        if (toggleGalleryBtn && avatarGallery) {
          toggleGalleryBtn.addEventListener("click", () => {
            const isHidden = avatarGallery.style.display === "none" || avatarGallery.style.display === "";
            avatarGallery.style.display = isHidden ? "block" : "none";
          });
        }
      })();
    </script>

<%- include('partials/footer') %>
