<%- include('partials/header', { title: 'My Promo Gallery | Encore', activePage: 'profile' }) %>

    <main class="container py-4">
      <!-- Promo gallery header with back link -->
      <div class="row justify-content-center mb-3">
        <div class="col-lg-8 d-flex justify-content-between align-items-center">
          <h3 class="fw-bold text-success mb-0">My promo gallery</h3>
          <a class="btn btn-outline-secondary btn-sm" href="/profile">Back to profile</a>
        </div>
      </div>

      <!-- Upload form + existing media list -->
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card card-elevated p-4 mb-4">
            <h5 class="fw-bold mb-3">Add a new media item</h5>

            <% if (error_message && error_message !== "") { %>
            <div class="alert alert-danger py-2"><%= error_message %></div>
            <% } %>

            <form action="/profile/media" method="POST" enctype="multipart/form-data">
              <div class="row g-3">
                <div class="col-12">
                  <label class="form-label" for="mediaFile">Media file</label>
                  <input
                    class="form-control"
                    type="file"
                    id="mediaFile"
                    name="mediaFile"
                    accept="image/*,video/*"
                    required
                  />
                  <div class="form-text">Max 50MB. Upload a photo or a short video from your computer.</div>
                </div>
              </div>
              <div class="mt-3 d-flex justify-content-end">
                <button class="btn btn-success" type="submit">Add media</button>
              </div>
            </form>
          </div>

          <div class="card card-elevated p-4">
            <h5 class="fw-bold mb-3">Your past event media</h5>

            <% if (!media || media.length === 0) { %>
            <p class="text-muted mb-0">You havenâ€™t added any media yet.</p>
            <% } else { %>
            <div class="row g-3">
              <% media.forEach(function(item) { %>
              <div class="col-md-4 col-sm-6">
                <div class="border rounded p-2 h-100">
                  <% if (item.media_type === 'image') { %>
                  <img
                    src="/uploads/<%= item.media_path %>"
                    alt="Event photo"
                    class="img-fluid rounded mb-2"
                  />
                  <% } else { %>
                  <div class="ratio ratio-16x9 mb-2">
                    <iframe
                      src="/uploads/<%= item.media_path %>"
                      title="Event video"
                      frameborder="0"
                      allowfullscreen
                    ></iframe>
                  </div>
                  <% } %>
                  <% if (item.created_at) { %>
                  <small class="text-muted">
                    Added on <%= new Date(item.created_at).toISOString().slice(0, 10) %>
                  </small>
                  <% } %>
                </div>
              </div>
              <% }); %>
            </div>
            <% } %>
          </div>
        </div>
      </div>
    </main>

<%- include('partials/footer') %>
